<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„åˆ›æ„ç©ºé—´</title>
    <style>
        /* åŸºç¡€æ ·å¼è®¾ç½® */
        :root {
            --primary-color: #8C52FF;
            --primary-dark: #6E3AD9;
            --secondary-color: #FF2E93;
            --accent-color: #00E9FF;
            --dark-bg: #121212;
            --card-bg: #1E1E1E;
            --text-light: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --chat-bg: rgba(30, 30, 30, 0.95);
            --chat-user-bg: var(--primary-color);
            --chat-ai-bg: #333333;
            --modal-overlay: rgba(0, 0, 0, 0.8);
            --resize-handle-color: rgba(140, 82, 255, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #121212, #1A1A2E);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* åŠ¨ç”»èƒŒæ™¯ */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 50px 160px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 90px 40px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 130px 80px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 160px 120px, #fff, rgba(0,0,0,0));
            background-repeat: repeat;
            background-size: 200px 200px;
            animation: twinkle 4s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* ä¸»è¦å†…å®¹å¸ƒå±€ */
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 0;
        }
        
        header {
            text-align: center;
            margin-bottom: 60px;
        }
        
        h1 {
            font-size: 3rem;
            margin: 20px 0;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        /* å¡ç‰‡å¸ƒå±€ */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(140, 82, 255, 0.3);
        }
        
        .card-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }
        
        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .card:hover .card-image img {
            transform: scale(1.05);
        }
        
        .card-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .card-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
            flex: 1;
        }
        
        .card-link-wrapper {
            text-align: center;
            margin-top: auto;
        }
        
        .card-link {
            display: inline-block;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: white;
            text-decoration: none;
            padding: 10px 30px;
            border-radius: 30px;
            font-weight: bold;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            min-width: 140px;
        }
        
        .card-link:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(110, 58, 217, 0.5);
        }
        
        /* å¡ç‰‡å…¨å±€é“¾æ¥ */
        .card-full-link {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
        }
        
        /* ç¡®ä¿æŒ‰é’®åœ¨å¡ç‰‡ä¸Šå±‚ */
        .card-link {
            position: relative;
            z-index: 2;
        }
        
        .card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            height: 50%;
        }
        
        /* åº•éƒ¨æ ·å¼ */
        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 60px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px 0;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .cards {
                grid-template-columns: 1fr;
            }
        }
        
        /* æ‚¬æµ®åŠ¨ç”» */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* AIèŠå¤©åŠ©æ‰‹æ ·å¼ */
        .chat-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(140, 82, 255, 0.5);
        }
        
        .chat-button svg {
            width: 30px;
            height: 30px;
            fill: white;
        }
        
        /* èŠå¤©æ¨¡æ€æ¡†æ ·å¼ - æ·»åŠ å¯è°ƒæ•´å¤§å°åŠŸèƒ½ */
        .chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-overlay);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .chat-modal.open {
            opacity: 1;
            visibility: visible;
        }
        
        /* æ€è€ƒå†…å®¹å®¹å™¨æ ·å¼ */
        .ai-thinking-content-container {
            width: 100%;
            word-break: break-word;
            white-space: pre-wrap;
            padding-bottom: 5px;
            line-height: 1.6;
        }
        
        /* è°ƒæ•´èŠå¤©å®¹å™¨çš„resizeè¡Œä¸º */
        .chat-container {
            position: relative;
            width: 800px; /* ä¿®æ”¹åˆå§‹å®½åº¦ä¸º500px */
            height: 800px; /* ä¿®æ”¹åˆå§‹é«˜åº¦ä¸º600px */
            background: var(--chat-bg);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            resize: both; /* æ·»åŠ å¯è°ƒæ•´å¤§å°åŠŸèƒ½ */
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            min-width: 300px; /* æœ€å°å®½åº¦ */
            min-height: 400px; /* æœ€å°é«˜åº¦ */
        }
        
        .chat-modal.open .chat-container {
            transform: scale(1);
        }
        
        /* ä¿®æ”¹èŠå¤©å¤´éƒ¨æ ·å¼ï¼Œä½¿æ ‡é¢˜å±…ä¸­ */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: var(--text-light);
            position: relative; /* æ·»åŠ ç›¸å¯¹å®šä½ */
        }
        
        .chat-header h3 {
            font-size: 1.2rem;
            margin: 0;
            position: absolute; /* ç»å¯¹å®šä½ */
            left: 50%; /* æ°´å¹³å±…ä¸­ */
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­å¾®è°ƒ */
        }
        
        /* å·¦ä¾§æŒ‰é’® */
        .header-left {
            z-index: 10;
        }
        
        /* å³ä¾§æŒ‰é’®ç»„ */
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }
        
        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }
        
        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* æ·»åŠ å¹³æ»‘æ»šåŠ¨æ•ˆæœ */
        .chat-messages,
        .ai-thinking-body {
            scroll-behavior: smooth;
            padding-right: 6px; /* ä¸ºæ»šåŠ¨æ¡é¢„ç•™ç©ºé—´ */
        }
        
        /* è°ƒæ•´èŠå¤©æ¶ˆæ¯åŒºåŸŸçš„å†…è¾¹è· */
        .chat-messages {
            flex: 1;
            padding: 20px 20px 20px 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }
        
        /* è°ƒæ•´æ€è€ƒå†…å®¹åŒºåŸŸçš„æ ·å¼ */
        .ai-thinking-container.expanded .ai-thinking-body {
            padding: 15px 15px 15px 20px;
        }
        
        /* ç¾åŒ–æ¶ˆæ¯æ ·å¼ */
        .message {
            animation: messageAppear 0.3s ease forwards;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 8px;
            word-break: break-word;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .message:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        /* æ¶ˆæ¯åŠ¨ç”»æ•ˆæœå¢å¼º */
        @keyframes messageAppear {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
                filter: blur(2px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
                filter: blur(0);
            }
        }
        
        /* ç”¨æˆ·æ¶ˆæ¯ç‰¹æ•ˆ */
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        /* AIæ¶ˆæ¯ç‰¹æ•ˆ */
        .ai-message {
            align-self: flex-start;
            background: linear-gradient(135deg, #333333, #222222);
            color: white;
            border-bottom-left-radius: 5px;
        }
        
        .ai-thinking-container {
            align-self: flex-start;
            max-width: 80%;
            margin-bottom: 10px;
            position: relative;
        }
        
        /* æ€è€ƒå†…å®¹åŒºåŸŸæ ·å¼ä¼˜åŒ– */
        .ai-thinking-body {
            background: rgba(30, 30, 30, 0.5);
            border-radius: 10px;
            margin-top: 5px;
            padding: 12px 15px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            opacity: 0;
            position: relative;
            border: 1px solid rgba(140, 82, 255, 0.1);
            backdrop-filter: blur(5px);
        }
        
        .ai-thinking-container.expanded .ai-thinking-body {
            max-height: 300px;
            overflow-y: auto;
            opacity: 1;
            padding: 15px 15px 15px 20px;
            margin-top: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* æ–°å¢æ ·å¼ - ä¸å›¾ç‰‡ä¸€è‡´çš„æ€è€ƒè¿‡ç¨‹æ ‡ç­¾ */
        .thinking-badge {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .thinking-badge-icon {
            margin-right: 4px;
            animation: thinking-pulse 2s infinite;
        }
        
        @keyframes thinking-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .thinking-badge-text {
            white-space: nowrap;
        }
        
        .thinking-badge-arrow {
            margin-left: 4px;
            transition: transform 0.3s ease;
        }
        
        .expanded .thinking-badge-arrow {
            transform: rotate(180deg);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .ai-thinking-body::-webkit-scrollbar,
        .chat-messages::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        
        .ai-thinking-body::-webkit-scrollbar-track,
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            margin: 4px;
        }
        
        .ai-thinking-body::-webkit-scrollbar-thumb,
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(140, 82, 255, 0.4);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 1px solid rgba(140, 82, 255, 0.1);
        }
        
        .ai-thinking-body::-webkit-scrollbar-thumb:hover,
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(140, 82, 255, 0.7);
        }
        
        /* æ»šåŠ¨æ¡è§’è½æ ·å¼ */
        .ai-thinking-body::-webkit-scrollbar-corner,
        .chat-messages::-webkit-scrollbar-corner {
            background: transparent;
        }
        
        /* ä¸ºFirefoxæ·»åŠ æ»šåŠ¨æ¡æ ·å¼ */
        .ai-thinking-body,
        .chat-messages {
            scrollbar-width: thin;
            scrollbar-color: rgba(140, 82, 255, 0.5) rgba(0, 0, 0, 0.1);
        }
        
        /* ç´«è‰²æ ‡ç­¾æ ·å¼ */
        .ai-thinking-tag {
            display: inline-block;
            background-color: rgba(140, 82, 255, 0.2);
            color: #b388ff;
            border-radius: 4px;
            padding: 2px 6px;
            margin-right: 5px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            margin-left: 15px;
            margin-bottom: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            margin-right: 4px;
            animation: typingAnimation 1s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* è¾“å…¥æ¡†æ ·å¼ä¼˜åŒ– */
        .chat-input-container {
            display: flex;
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            outline: none;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .chat-input:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(140, 82, 255, 0.3);
        }
        
        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* å‘é€æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .send-button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, var(--primary-color), #5e2cc2);
        }
        
        .stop-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }
        
        .stop-button:hover {
            background: #e01b7a;
        }
        
        /* å“åº”å¼èŠå¤©çª—å£ */
        @media (max-width: 768px) {
            .chat-container {
                width: 95%;
                height: 90%;
            }
        }
        
        /* æ·»åŠ Markdownæ ·å¼ */
        .markdown-body {
            line-height: 1.6;
            word-wrap: break-word;
            color: var(--text-light);
        }
        
        .markdown-body h1, .markdown-body h2, .markdown-body h3, 
        .markdown-body h4, .markdown-body h5, .markdown-body h6 {
            margin-top: 16px;
            margin-bottom: 12px;
            font-weight: 600;
            line-height: 1.25;
        }
        
        .markdown-body h1 {
            font-size: 1.6em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0.3em;
        }
        
        .markdown-body h2 {
            font-size: 1.4em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0.3em;
        }
        
        .markdown-body h3 {
            font-size: 1.2em;
        }
        
        .markdown-body h4 {
            font-size: 1.1em;
        }
        
        .markdown-body h5, .markdown-body h6 {
            font-size: 1em;
        }
        
        .markdown-body p {
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .markdown-body ul, .markdown-body ol {
            margin-top: 0;
            margin-bottom: 10px;
            padding-left: 2em;
        }
        
        .markdown-body ul ul, .markdown-body ol ol,
        .markdown-body ul ol, .markdown-body ol ul {
            margin-top: 0;
            margin-bottom: 0;
        }
        
        .markdown-body li {
            margin-bottom: 4px;
        }
        
        .markdown-body blockquote {
            margin: 0;
            padding: 0 1em;
            color: rgba(255, 255, 255, 0.7);
            border-left: 0.25em solid var(--primary-color);
        }
        
        .markdown-body code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .markdown-body pre {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            word-wrap: normal;
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            margin-top: 0;
            margin-bottom: 16px;
        }
        
        .markdown-body pre code {
            display: inline;
            max-width: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0;
        }
        
        .markdown-body table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }
        
        .markdown-body table th, .markdown-body table td {
            padding: 6px 13px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .markdown-body table th {
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .markdown-body img {
            max-width: 100%;
            box-sizing: content-box;
            border-radius: 4px;
        }
        
        .markdown-body hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: rgba(255, 255, 255, 0.1);
            border: 0;
        }
        
        .markdown-body a {
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .markdown-body a:hover {
            text-decoration: underline;
        }
        
        .markdown-body .math {
            font-style: italic;
        }
        
        .markdown-body .boxed {
            border: 1px solid var(--primary-color);
            padding: 2px 5px;
            border-radius: 4px;
            display: inline-block;
            background-color: rgba(140, 82, 255, 0.1);
        }
        
        /* æ·»åŠ è°ƒæ•´å¤§å°çš„æ‰‹æŸ„æ ·å¼ */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: nwse-resize;
            background: linear-gradient(135deg, transparent 50%, var(--resize-handle-color) 50%);
            border-radius: 0 0 16px 0;
            z-index: 10;
        }
        
        /* ä¸‹è½½æŒ‰é’®æ ·å¼ */
        .download-button {
            position: absolute;
            top: 15px;
            right: 100px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .download-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* æ·»åŠ æŒ‰é’®æç¤ºæ–‡æœ¬ */
        .download-button::after {
            content: "ä¸‹è½½å¯¹è¯";
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            white-space: nowrap;
            z-index: 100;
        }
        
        .download-button:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* åˆ é™¤è¿›åº¦æ¡æ ·å¼ */
        .ai-thinking-progress {
            display: none; /* éšè—è¿›åº¦æ¡ */
        }
        
        /* å…¨å±æŒ‰é’®æ ·å¼ */
        .fullscreen-button {
            position: absolute;
            top: 15px;
            right: 140px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease;
            z-index: 10;
        }
        
        .fullscreen-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* æ·»åŠ æŒ‰é’®æç¤ºæ–‡æœ¬ */
        .fullscreen-button::after {
            content: "å…¨å±åˆ‡æ¢";
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            white-space: nowrap;
            z-index: 100;
        }
        
        .fullscreen-button:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .chat-container.fullscreen {
            width: 95% !important;
            height: 95% !important;
            border-radius: 8px;
        }
        
        /* ä¿®æ”¹æ¸…é™¤æŒ‰é’®æ ·å¼ï¼Œä½¿å…¶æ›´ç›´è§‚ */
        .clear-button {
            position: absolute;
            top: 15px;
            right: 60px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease;
            z-index: 10;
        }
        
        .clear-button:hover {
            background: rgba(255, 0, 0, 0.3); /* çº¢è‰²èƒŒæ™¯æç¤ºåˆ é™¤åŠŸèƒ½ */
        }
        
        /* æ·»åŠ æŒ‰é’®æç¤ºæ–‡æœ¬ */
        .clear-button::after {
            content: "æ¸…ç©ºå¯¹è¯";
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            white-space: nowrap;
            z-index: 100;
        }
        
        .clear-button:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* æ·»åŠ header-buttonsæ ·å¼ */
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* æ€è€ƒæ ‡é¢˜æ ·å¼ä¼˜åŒ– */
        .ai-thinking-header {
            display: flex;
            align-items: center;
            background: linear-gradient(90deg, rgba(140, 82, 255, 0.3), rgba(0, 0, 0, 0.2));
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .ai-thinking-header:hover {
            background: linear-gradient(90deg, rgba(140, 82, 255, 0.4), rgba(0, 0, 0, 0.3));
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .ai-thinking-title {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .ai-thinking-title .icon {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        .ai-thinking-time {
            margin-left: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .ai-thinking-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .ai-thinking-container.expanded .ai-thinking-arrow {
            transform: rotate(180deg);
        }
        
        .ai-thinking-content {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="background">
        <div class="stars"></div>
    </div>
    
    <div class="container">
        <header>
            <h1 class="floating">æˆ‘çš„åˆ›æ„ç©ºé—´</h1>
            <p class="subtitle">æ¢ç´¢åˆ›æ„ï¼Œæ„Ÿå—ç§‘æŠ€ä¸è‰ºæœ¯çš„ç¾å¦™</p>
        </header>
        
        <div class="cards">
            <!-- Valorant CPUä¼˜åŒ–å·¥å…·å¡ç‰‡ -->
            <div class="card">
                <a href="download.html" class="card-full-link"></a>
                <div class="card-image">
                    <img src="./èµ„æº/ä¼˜åŒ–åä½œå¼Šå ç”¨è„šæœ¬/ä¼˜åŒ–å›¾ç‰‡.avif" alt="Valorant CPUä¼˜åŒ–">
                    <div class="card-overlay"></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">Valorant CPUä¼˜åŒ–å·¥å…·</h2>
                    <p class="card-description">ä¸“ä¸ºç“¦æ´›å…°ç‰¹ç©å®¶è®¾è®¡çš„æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼Œé€šè¿‡æ™ºèƒ½è°ƒèŠ‚åä½œå¼Šè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œæœ‰æ•ˆæå‡æ¸¸æˆä½“éªŒï¼Œè®©ä½ çš„å¯¹æˆ˜æ›´åŠ æµç•…ã€‚</p>
                    <div class="card-link-wrapper">
                        <a href="download.html" class="card-link">ç«‹å³ä¼˜åŒ–</a>
                    </div>
                </div>
            </div>
            
            <!-- å¿ƒå½¢åŠ¨ç”»å¡ç‰‡ -->
            <div class="card">
                <a href="love.html" class="card-full-link"></a>
                <div class="card-image">
                    <img src="./èµ„æº/æ˜Ÿçƒ/photo-1.avif" alt="çˆ±å¿ƒåŠ¨ç”»">
                    <div class="card-overlay"></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">å¿ƒåŠ¨æ—¶åˆ»</h2>
                    <p class="card-description">å”¯ç¾æµªæ¼«çš„3Då¿ƒå½¢åŠ¨ç”»ï¼Œè®©çˆ±æ„åœ¨ç©ºé—´ä¸­æµè½¬ï¼Œè¥é€ æ¸©é¦¨æ„Ÿäººçš„æ°›å›´ã€‚</p>
                    <div class="card-link-wrapper">
                        <a href="love.html" class="card-link">ä½“éªŒä¸€ä¸‹</a>
                    </div>
                </div>
            </div>
            
            <!-- å¤ªé˜³ç³»å¡ç‰‡ -->
            <div class="card">
                <a href="ninestars.html" class="card-full-link"></a>
                <div class="card-image">
                    <img src="./èµ„æº/æ˜Ÿçƒ/photo-2.avif" alt="å¤ªé˜³ç³»ä¹æ˜Ÿè¿ç ">
                    <div class="card-overlay"></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">å¤ªé˜³ç³»ä¹æ˜Ÿè¿ç </h2>
                    <p class="card-description">æ¢ç´¢å®‡å®™å¥¥ç§˜ï¼Œè§‚èµç½•è§çš„ä¹å¤§è¡Œæ˜Ÿæ’åˆ—å¥‡è§‚ï¼Œæ„Ÿå—æµ©ç€šå®‡å®™çš„ç¥å¥‡é­…åŠ›ã€‚</p>
                    <div class="card-link-wrapper">
                        <a href="ninestars.html" class="card-link">æ¢ç´¢å®‡å®™</a>
                    </div>
                </div>
            </div>
            
            <!-- è¡¥å…‰ç¯è‡ªæ‹å¡ç‰‡ -->
            <div class="card">
                <a href="photo.html" class="card-full-link"></a>
                <div class="card-image">
                    <img src="./èµ„æº/æ˜Ÿçƒ/photo-3.avif" alt="æ˜Ÿè±ªè¡¥å…‰ç¯">
                    <div class="card-overlay"></div>
                </div>
                <div class="card-content">
                    <h2 class="card-title">ç¾é¢œè¡¥å…‰ç¯</h2>
                    <p class="card-description">éšæ—¶éšåœ°æ‹å‡ºå®Œç¾è‡ªæ‹ï¼Œä¸“ä¸šè¡¥å…‰æ•ˆæœè®©ä½ åœ¨å„ç§å…‰çº¿ç¯å¢ƒä¸‹éƒ½èƒ½å…‰å½©ç…§äººã€‚</p>
                    <div class="card-link-wrapper">
                        <a href="photo.html" class="card-link">å¼€å§‹è‡ªæ‹</a>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2023 åˆ›æ„ç©ºé—´ - ç”¨ç§‘æŠ€ç‚¹äº®ç”Ÿæ´»</p>
        </footer>
    </div>
    
    <!-- AIèŠå¤©åŠ©æ‰‹æŒ‰é’® -->
    <button class="chat-button" aria-label="æ‰“å¼€AIåŠ©æ‰‹">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16 13H13V16C13 16.55 12.55 17 12 17C11.45 17 11 16.55 11 16V13H8C7.45 13 7 12.55 7 12C7 11.45 7.45 11 8 11H11V8C11 7.45 11.45 7 12 7C12.55 7 13 7.45 13 8V11H16C16.55 11 17 11.45 17 12C17 12.55 16.55 13 16 13Z" fill="currentColor"/>
        </svg>
    </button>
    
    <!-- AIèŠå¤©åŠ©æ‰‹æ¨¡æ€æ¡† -->
    <div class="chat-modal">
        <div class="chat-container">
            <div class="chat-header">
                <div class="header-left">
                    <button class="fullscreen-button" aria-label="å…¨å±åˆ‡æ¢" title="å…¨å±åˆ‡æ¢">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <h3>åˆ›æ„åŠ©æ‰‹</h3>
                <div class="header-right">
                    <button class="download-button" aria-label="ä¸‹è½½å¯¹è¯" title="ä¸‹è½½å¯¹è¯è®°å½•">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 10L12 15L17 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 15V3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="clear-button" aria-label="æ¸…é™¤å¯¹è¯" title="æ¸…é™¤å¯¹è¯å†å²">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 6H5M14 5H10M6 10V19C6 19.5304 6.21071 20.0391 6.58579 20.4142C6.96086 20.7893 7.46957 21 8 21H16C16.5304 21 17.0391 20.7893 17.4142 20.4142C17.7893 20.0391 18 19.5304 18 19V10H6Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="chat-close" aria-label="å…³é—­èŠå¤©">Ã—</button>
                </div>
            </div>
            <div class="chat-messages">
                <!-- <div class="message ai-message"></div> -->
            </div>
            <div class="typing-indicator" style="display: none;">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." aria-label="èŠå¤©è¾“å…¥æ¡†">
                <button class="send-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="resize-handle"></div>
        </div>
    </div>
    
    <script>
        // æ·»åŠ Markdownè§£æåº“ - Marked.js
        // ç«‹å³åŠ è½½Marked.jså’ŒKaTeX
        (function loadExternalLibraries() {
            // åŠ è½½Marked.js
            const markedScript = document.createElement('script');
            markedScript.src = 'https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js';
            markedScript.onload = function() {
                console.log('Marked.jså·²åŠ è½½');
                // é…ç½®Markedé€‰é¡¹
                marked.setOptions({
                    breaks: true,        // å…è®¸æ¢è¡Œç¬¦è½¬æ¢ä¸º<br>
                    gfm: true,           // å¯ç”¨GitHubé£æ ¼Markdown
                    headerIds: false,    // ä¸ç”Ÿæˆæ ‡é¢˜ID
                    mangle: false,       // ä¸è½¬ä¹‰å†…è”HTML
                    sanitize: false,     // ä¸å‡€åŒ–è¾“å‡º
                    smartLists: true,    // ä½¿ç”¨æ›´æ™ºèƒ½çš„åˆ—è¡¨è¡Œä¸º
                    smartypants: true,   // ä½¿ç”¨æ›´æ™ºèƒ½çš„æ ‡ç‚¹ç¬¦å·
                    xhtml: false         // ä¸ä½¿ç”¨è‡ªé—­åˆæ ‡ç­¾
                });
            };
            document.head.appendChild(markedScript);
            
            // åŠ è½½KaTeX CSS
            const katexCSS = document.createElement('link');
            katexCSS.rel = 'stylesheet';
            katexCSS.href = 'https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css';
            document.head.appendChild(katexCSS);
            
            // åŠ è½½KaTeX JS
            const katexScript = document.createElement('script');
            katexScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js';
            document.head.appendChild(katexScript);
            
            // åŠ è½½KaTeX Auto-renderæ‰©å±•
            const katexAutoScript = document.createElement('script');
            katexAutoScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js';
            document.head.appendChild(katexAutoScript);
        })();

        // æ–‡æ¡£åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½Marked.js
            if (typeof marked === 'undefined') {
                const markedScript = document.createElement('script');
                markedScript.src = 'https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js';
                markedScript.onload = function() {
                    console.log('Marked.jså·²åŠ è½½');
                    // é…ç½®Markedé€‰é¡¹
                    marked.setOptions({
                        breaks: true,
                        gfm: true,
                        headerIds: false,
                        mangle: false
                    });
                };
                document.head.appendChild(markedScript);
            }
            
            const cards = document.querySelectorAll('.card');
            
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.borderColor = getRandomColor();
                });
            });
            
            function getRandomColor() {
                const colors = ['#8C52FF', '#FF2E93', '#00E9FF', '#FFDE59', '#00FF85'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            // AIèŠå¤©åŠ©æ‰‹åŠŸèƒ½
            const chatButton = document.querySelector('.chat-button');
            const chatModal = document.querySelector('.chat-modal');
            const chatClose = document.querySelector('.chat-close');
            const chatMessages = document.querySelector('.chat-messages');
            const chatInput = document.querySelector('.chat-input');
            const sendButton = document.querySelector('.send-button');
            const typingIndicator = document.querySelector('.typing-indicator');
            
            const apiParts = [
                atob('MzYuMTMz'), 
                atob('LjE4LjI3'), 
                atob('OjExNDM0')  
            ];
            
            // æ¨¡å‹åç§°ä¹Ÿè¿›è¡Œç¼–ç å­˜å‚¨
            const modelName = atob('ZGVlcHNlZWstcjE6NzBi'); // deepseek-r1:70b
            
            // èŠå¤©çª—å£å¼€å…³
            chatButton.addEventListener('click', () => {
                chatModal.classList.add('open');
                setTimeout(() => {
                    chatInput.focus();
                }, 300);
            });
            
            chatClose.addEventListener('click', () => {
                chatModal.classList.remove('open');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            chatModal.addEventListener('click', (e) => {
                if (e.target === chatModal) {
                    chatModal.classList.remove('open');
                }
            });
            
            // è·å–APIåŸŸåçš„å‡½æ•° - è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼Œå¢åŠ å®‰å…¨æ€§
            function getApiEndpoint() {
                // ä½¿ç”¨éƒ¨ç½²åœ¨Vercelä¸Šçš„ä»£ç†API
                // æ³¨æ„ï¼šå°†ä¸‹é¢çš„URLæ›¿æ¢ä¸ºæ‚¨çš„Vercelåº”ç”¨URL
                const vercelProxyUrl = 'https://hxh.paydn.cn';
                
                // è¿”å›Vercelä»£ç†APIçš„URL
                return vercelProxyUrl;
            }
            
            // åˆ›å»ºAIæ€è€ƒè¿‡ç¨‹å…ƒç´  - ä¿®å¤ç‰ˆ
            function createThinkingElement(initialText = 'æ€è€ƒä¸­...') {
                // åˆ›å»ºå®¹å™¨
                const container = document.createElement('div');
                container.classList.add('ai-thinking-container');
                
                // åˆ›å»ºæ€è€ƒæ ‡ç­¾ - æ–°æ ·å¼
                const thinkingBadge = document.createElement('div');
                thinkingBadge.classList.add('thinking-badge');
                
                // æ·»åŠ å›¾æ ‡
                const badgeIcon = document.createElement('span');
                badgeIcon.classList.add('thinking-badge-icon');
                badgeIcon.innerHTML = 'ğŸ§ ';
                thinkingBadge.appendChild(badgeIcon);
                
                // æ·»åŠ æ–‡æœ¬
                const badgeText = document.createElement('span');
                badgeText.classList.add('thinking-badge-text');
                badgeText.textContent = 'æ€è€ƒè¿‡ç¨‹';
                thinkingBadge.appendChild(badgeText);
                
                // æ·»åŠ ç®­å¤´
                const badgeArrow = document.createElement('span');
                badgeArrow.classList.add('thinking-badge-arrow');
                badgeArrow.textContent = 'â–¼';
                thinkingBadge.appendChild(badgeArrow);
                
                // æ·»åŠ åˆ°å¤´éƒ¨
                const header = document.createElement('div');
                header.classList.add('ai-thinking-header');
                header.appendChild(thinkingBadge);
                
                // æ·»åŠ æ—¶é—´
                const timeSpan = document.createElement('span');
                timeSpan.classList.add('ai-thinking-time');
                
                // è®¡ç®—æ€è€ƒæ—¶é—´çš„å‡½æ•°
                const startTime = Date.now();
                let timerStopped = false;
                let finalElapsed = 0;
                
                const updateTime = () => {
                    if (timerStopped) {
                        timeSpan.textContent = `(ç”¨æ—¶${finalElapsed}ç§’)`;
                    } else {
                        const elapsed = Math.floor((Date.now() - startTime) / 1000);
                        timeSpan.textContent = `(ç”¨æ—¶${elapsed}ç§’)`;
                    }
                };
                
                // åˆå§‹æ›´æ–°æ—¶é—´
                updateTime();
                
                // è®¾ç½®å®šæ—¶å™¨æ¯ç§’æ›´æ–°æ—¶é—´
                const timer = setInterval(() => {
                    if (!timerStopped) {
                        updateTime();
                    }
                }, 1000);
                
                header.appendChild(timeSpan);
                
                // åˆ›å»ºå†…å®¹åŒºåŸŸ
                const body = document.createElement('div');
                body.classList.add('ai-thinking-body');
                
                // åˆ›å»ºå†…å®¹å®¹å™¨ï¼Œç”¨äºå­˜æ”¾å®é™…æ–‡æœ¬
                const contentContainer = document.createElement('div');
                contentContainer.classList.add('ai-thinking-content-container');
                body.appendChild(contentContainer);
                
                // æ·»åŠ åˆå§‹æ–‡æœ¬
                contentContainer.textContent = initialText;
                
                // æ·»åŠ åˆ°å®¹å™¨
                container.appendChild(header);
                container.appendChild(body);
                
                // é»˜è®¤å±•å¼€æ€è€ƒå…ƒç´ 
                container.classList.add('expanded');
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                header.addEventListener('click', () => {
                    container.classList.toggle('expanded');
                });
                
                // ç”¨äºè‡ªåŠ¨æ»šåŠ¨çš„å˜é‡
                let lastContentLength = initialText.length;
                let userScrolled = false; // è·Ÿè¸ªç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨æ»šåŠ¨
                
                // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ£€æµ‹ç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨æ»šåŠ¨
                body.addEventListener('scroll', () => {
                    // æ£€æŸ¥æ˜¯å¦åœ¨åº•éƒ¨
                    const isAtBottom = body.scrollHeight - body.clientHeight <= body.scrollTop + 10;
                    
                    // å¦‚æœä¸åœ¨åº•éƒ¨ï¼Œè¯´æ˜ç”¨æˆ·æ‰‹åŠ¨æ»šåŠ¨äº†
                    if (!isAtBottom) {
                        userScrolled = true;
                    } else {
                        userScrolled = false; // ç”¨æˆ·æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œé‡ç½®æ ‡å¿—
                    }
                });
                
                return { 
                    thinkingElement: container, 
                    contentElement: contentContainer,
                    stopTimer: () => {
                        if (!timerStopped) {
                            timerStopped = true;
                            finalElapsed = Math.floor((Date.now() - startTime) / 1000);
                            updateTime();
                            clearInterval(timer);
                        }
                    },
                    setThinkContent: (content) => {
                        // è®¾ç½®å†…å®¹
                        contentContainer.textContent = content;
                        
                        // åªæœ‰å½“ç”¨æˆ·æ²¡æœ‰æ‰‹åŠ¨æ»šåŠ¨æ—¶ï¼Œæ‰è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                        if (!userScrolled) {
                            body.scrollTop = body.scrollHeight;
                        }
                        
                        lastContentLength = content.length;
                    },
                    toggleExpanded: (expanded) => {
                        // æ§åˆ¶å±•å¼€/æ”¶èµ·çŠ¶æ€
                        if (expanded) {
                            container.classList.add('expanded');
                        } else {
                            container.classList.remove('expanded');
                        }
                    }
                };
            }
            
            // å…¨å±€å˜é‡ï¼Œç”¨äºè·Ÿè¸ªå½“å‰æ˜¯å¦æ­£åœ¨ç”Ÿæˆå›å¤
            let isGeneratingResponse = false;
            
            // å…¨å±€å˜é‡ï¼Œç”¨äºæ§åˆ¶ç”Ÿæˆæ˜¯å¦åº”è¯¥åœæ­¢
            let shouldStopGeneration = false;
            
            // æ·»åŠ å¯¹è¯å†å²è®°å½•æ•°ç»„
            let conversationHistory = [];
            
            // è·å–AIå›å¤
            async function getAIResponse(userMessage) {
                // è®¾ç½®ç”ŸæˆçŠ¶æ€ä¸ºtrue
                isGeneratingResponse = true;
                shouldStopGeneration = false;  // ç¡®ä¿æ¯æ¬¡å¼€å§‹æ–°å¯¹è¯æ—¶é‡ç½®ç»ˆæ­¢æ ‡å¿—
                
                // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥
                typingIndicator.style.display = 'flex';
                
                // å°†å‘é€æŒ‰é’®å˜ä¸ºåœæ­¢æŒ‰é’®
                toggleSendStopButton(true);
                
                // åˆ›å»ºæ€è€ƒè¿‡ç¨‹å…ƒç´ 
                const { thinkingElement, contentElement, setThinkContent, stopTimer, toggleExpanded } = createThinkingElement('æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜...');
                chatMessages.appendChild(thinkingElement);
                
                // åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å…ƒç´ ç”¨äºå®æ—¶æ˜¾ç¤ºå›å¤
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', 'ai-message');
                messageElement.style.display = 'none'; // åˆå§‹éšè—
                
                // ç”¨æˆ·æ˜¯å¦æ­£åœ¨æŸ¥çœ‹æœ€æ–°æ¶ˆæ¯
                let isUserAtBottom = true;
                
                // ç›‘å¬æ»šåŠ¨äº‹ä»¶
                const scrollHandler = () => {
                    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨åº•éƒ¨
                    const isAtBottom = chatMessages.scrollHeight - chatMessages.clientHeight <= chatMessages.scrollTop + 50;
                    isUserAtBottom = isAtBottom;
                };
                
                // æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬
                chatMessages.addEventListener('scroll', scrollHandler);
                
                try {
                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²è®°å½•
                    conversationHistory.push({ role: 'user', content: userMessage });
                    
                    // æ„å»ºè¯·æ±‚æ•°æ®ï¼ŒåŒ…å«å¯¹è¯å†å²
                    const requestData = {
                        model: modelName,
                        prompt: buildPromptWithHistory(),
                        stream: true,
                        options: {
                            temperature: 0.7,
                            top_p: 0.9
                        }
                    };
                    
                    // æ›´æ–°æ€è€ƒè¿‡ç¨‹
                    setThinkContent(`æ­£åœ¨åˆ†æé—®é¢˜: "${userMessage}"...`);
                    
                    // è·å–APIç«¯ç‚¹ - ä½¿ç”¨Vercelä»£ç†
                    let apiUrl = getApiEndpoint() + '/api/ollama/generate';
                    
                    // æ ¹æ®è¯·æ±‚ç±»å‹é€‰æ‹©ä¸åŒçš„APIç«¯ç‚¹
                    if (requestData.stream === true) {
                        // å¦‚æœéœ€è¦æµå¼å“åº”ï¼Œä½¿ç”¨æµå¼APIç«¯ç‚¹
                        apiUrl = getApiEndpoint() + '/api/ollama-stream/generate';
                    }
                    
                    // ä½¿ç”¨fetch APIè°ƒç”¨ä»£ç†API
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ç§’è¶…æ—¶
                    
                    // æ·»åŠ é‡è¯•é€»è¾‘
                    let response = null;
                    let retryCount = 0;
                    const maxRetries = 2;
                    
                    while (retryCount <= maxRetries) {
                        try {
                            if (retryCount > 0) {
                                setThinkContent(`é‡è¯•è¯·æ±‚ (${retryCount}/${maxRetries})...`);
                                await sleep(1000); // é‡è¯•å‰ç­‰å¾…1ç§’
                            }
                            
                            response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(requestData),
                                signal: controller.signal
                            });
                            
                            // å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè·³å‡ºå¾ªç¯
                            if (response.ok) break;
                            
                            // å¦‚æœæ˜¯CORSé”™è¯¯ï¼Œå°è¯•ä½¿ç”¨ä¸åŒçš„æ–¹æ³•
                            if (response.status === 0 || response.type === 'opaque') {
                                throw new Error('CORSé”™è¯¯ï¼Œå°è¯•å…¶ä»–æ–¹æ³•');
                            }
                            
                            throw new Error(`APIè¿”å›é”™è¯¯: ${response.status} ${response.statusText}`);
                        } catch (error) {
                            // æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥
                            if (retryCount === maxRetries) {
                                setThinkContent(`è¯·æ±‚å¤±è´¥: ${error.message}`);
                                throw error;
                            }
                            
                            retryCount++;
                        }
                    }
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        setThinkContent(`APIè¿”å›é”™è¯¯: ${response.status} ${response.statusText}`);
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                    }
                    
                    // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
                    typingIndicator.style.display = 'none';
                    
                    // æ˜¾ç¤ºæ¶ˆæ¯å…ƒç´ 
                    chatMessages.appendChild(messageElement);
                    messageElement.style.display = 'block';
                    
                    // å¤„ç†æµå¼å“åº”
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let aiReply = '';  // ç´¯ç§¯çš„AIå›å¤
                    let thinkContent = '';  // ç´¯ç§¯çš„æ€è€ƒå†…å®¹
                    let hasThinkTag = false; // æ ‡è®°æ˜¯å¦æœ‰æ€è€ƒå†…å®¹
                    
                    // ç”¨äºè·Ÿè¸ªå½“å‰æ˜¯å¦åœ¨<think>æ ‡ç­¾å†…
                    let isInsideThinkTag = false;
                    let currentThinkContent = '';
                    let currentReplyContent = '';
                    let buffer = '';  // ç”¨äºå­˜å‚¨æœªå®Œæˆçš„æ ‡ç­¾å†…å®¹
                    
                    // ç¡®ä¿æ€è€ƒå…ƒç´ å¯è§ - åˆå§‹çŠ¶æ€ä¸‹å°±å¯ä»¥ç¼©æ”¾
                    thinkingElement.style.display = 'block';
                    
                    while (true) {
                        // æ£€æŸ¥æ˜¯å¦åº”è¯¥åœæ­¢ç”Ÿæˆ
                        if (shouldStopGeneration) {
                            controller.abort();
                            break;
                        }
                        
                        const { done, value } = await reader.read();
                        if (done) break;
                        
                        // è§£ç äºŒè¿›åˆ¶æ•°æ®
                        const chunk = decoder.decode(value, { stream: true });
                        buffer += chunk;
                        
                        try {
                            // è§£æJSONè¡Œ
                            const lines = buffer.split('\n');
                            // ä¿ç•™æœ€åä¸€è¡Œï¼Œå¯èƒ½æ˜¯ä¸å®Œæ•´çš„
                            buffer = lines.pop() || '';
                            
                            for (const line of lines.filter(line => line.trim() !== '')) {
                                // æ£€æŸ¥æ˜¯å¦åº”è¯¥åœæ­¢ç”Ÿæˆ
                                if (shouldStopGeneration) {
                                    break;
                                }
                                
                                try {
                                    const data = JSON.parse(line);
                                    
                                    // å¤„ç†å“åº”æ–‡æœ¬
                                    if (data.response) {
                                        let responseText = data.response;
                                        
                                        // å®æ—¶å¤„ç†æ–‡æœ¬ï¼ŒåŒºåˆ†<think>æ ‡ç­¾å†…å®¹å’Œæ™®é€šå›å¤
                                        let i = 0;
                                        while (i < responseText.length) {
                                            // æ£€æŸ¥<think>å¼€å§‹æ ‡ç­¾
                                            if (!isInsideThinkTag && responseText.substring(i, i + 7) === '<think>') {
                                                isInsideThinkTag = true;
                                                hasThinkTag = true;
                                                i += 7; // è·³è¿‡<think>æ ‡ç­¾
                                                continue;
                                            }
                                            
                                            // æ£€æŸ¥</think>ç»“æŸæ ‡ç­¾
                                            if (isInsideThinkTag && responseText.substring(i, i + 8) === '</think>') {
                                                isInsideThinkTag = false;
                                                i += 8; // è·³è¿‡</think>æ ‡ç­¾
                                                continue;
                                            }
                                            
                                            // æ ¹æ®å½“å‰çŠ¶æ€æ·»åŠ å­—ç¬¦åˆ°ç›¸åº”å†…å®¹
                                            if (isInsideThinkTag) {
                                                currentThinkContent += responseText[i];
                                            } else {
                                                currentReplyContent += responseText[i];
                                            }
                                            
                                            i++;
                                        }
                                        
                                        // æ›´æ–°æ€è€ƒå†…å®¹æ˜¾ç¤º
                                        if (currentThinkContent) {
                                            thinkContent = currentThinkContent;
                                            setThinkContent(thinkContent);
                                        }
                                        
                                        // æ›´æ–°å›å¤å†…å®¹æ˜¾ç¤º
                                        if (currentReplyContent) {
                                            aiReply = currentReplyContent;
                                            
                                            try {
                                                // ä½¿ç”¨innerHTMLå’ŒMarkdownè§£ææ›¿ä»£textContent
                                                if (typeof marked !== 'undefined') {
                                                    // å¤„ç†è‡ªå®šä¹‰Markdown
                                                    const processedText = processCustomMarkdown(aiReply);
                                                    messageElement.classList.add('markdown-body');
                                                    messageElement.innerHTML = marked.parse(processedText);
                                                    
                                                    // æ¸²æŸ“æ•°å­¦å…¬å¼
                                                    if (typeof renderMathInElement !== 'undefined') {
                                                        renderMathInElement(messageElement, {
                                                            delimiters: [
                                                                {left: '$$', right: '$$', display: true},
                                                                {left: '$', right: '$', display: false},
                                                                {left: '\\(', right: '\\)', display: false},
                                                                {left: '\\[', right: '\\]', display: true}
                                                            ],
                                                            throwOnError: false
                                                        });
                                                    }
                                                } else {
                                                    // å¦‚æœMarkedæœªåŠ è½½ï¼Œä½¿ç”¨æ™®é€šæ–‡æœ¬
                                                    messageElement.textContent = aiReply;
                                                }
                                            } catch (error) {
                                                console.error('Markdownè§£æé”™è¯¯:', error);
                                                messageElement.textContent = aiReply;
                                            }
                                        }
                                        
                                        // åªæœ‰å½“ç”¨æˆ·åœ¨åº•éƒ¨æ—¶æ‰è‡ªåŠ¨æ»šåŠ¨
                                        if (isUserAtBottom) {
                                            chatMessages.scrollTop = chatMessages.scrollHeight;
                                        }
                                    }
                                } catch (parseError) {
                                    console.warn('è§£æJSONè¡Œå‡ºé”™:', parseError);
                                }
                            }
                        } catch (e) {
                            console.warn('å¤„ç†å“åº”å‡ºé”™:', e);
                        }
                    }
                    
                    // å¤„ç†å¯èƒ½æ®‹ç•™åœ¨bufferä¸­çš„å†…å®¹
                    if (buffer.trim()) {
                        try {
                            const data = JSON.parse(buffer);
                            if (data.response) {
                                // ä½¿ç”¨ç›¸åŒçš„é€»è¾‘å¤„ç†æœ€åä¸€å—æ•°æ®
                                let responseText = data.response;
                                
                                let i = 0;
                                while (i < responseText.length) {
                                    if (!isInsideThinkTag && responseText.substring(i, i + 7) === '<think>') {
                                        isInsideThinkTag = true;
                                        hasThinkTag = true;
                                        i += 7;
                                        continue;
                                    }
                                    
                                    if (isInsideThinkTag && responseText.substring(i, i + 8) === '</think>') {
                                        isInsideThinkTag = false;
                                        i += 8;
                                        continue;
                                    }
                                    
                                    if (isInsideThinkTag) {
                                        currentThinkContent += responseText[i];
                                    } else {
                                        currentReplyContent += responseText[i];
                                    }
                                    
                                    i++;
                                }
                                
                                // æœ€ç»ˆæ›´æ–°æ˜¾ç¤º
                                if (currentReplyContent) {
                                    aiReply = currentReplyContent;
                                    
                                    try {
                                        // ä½¿ç”¨innerHTMLå’ŒMarkdownè§£ææ›¿ä»£textContent
                                        if (typeof marked !== 'undefined') {
                                            // å¤„ç†è‡ªå®šä¹‰Markdown
                                            const processedText = processCustomMarkdown(aiReply);
                                            messageElement.classList.add('markdown-body');
                                            messageElement.innerHTML = marked.parse(processedText);
                                            
                                            // æ¸²æŸ“æ•°å­¦å…¬å¼
                                            if (typeof renderMathInElement !== 'undefined') {
                                                renderMathInElement(messageElement, {
                                                    delimiters: [
                                                        {left: '$$', right: '$$', display: true},
                                                        {left: '$', right: '$', display: false},
                                                        {left: '\\(', right: '\\)', display: false},
                                                        {left: '\\[', right: '\\]', display: true}
                                                    ],
                                                    throwOnError: false
                                                });
                                            }
                                        } else {
                                            // å¦‚æœMarkedæœªåŠ è½½ï¼Œä½¿ç”¨æ™®é€šæ–‡æœ¬
                                            messageElement.textContent = aiReply;
                                        }
                                    } catch (error) {
                                        console.error('Markdownè§£æé”™è¯¯:', error);
                                        messageElement.textContent = aiReply;
                                    }
                                }
                            }
                        } catch (e) {
                            console.warn('å¤„ç†å‰©ä½™bufferå‡ºé”™:', e);
                        }
                    }
                    
                    // åœæ­¢è®¡æ—¶å™¨
                    stopTimer();
                    
                    // å¦‚æœæ²¡æœ‰æ”¶åˆ°ä»»ä½•å›å¤ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    if (!aiReply) {
                        if (shouldStopGeneration) {
                            messageElement.textContent = 'ç”Ÿæˆå·²è¢«ç”¨æˆ·ç»ˆæ­¢ã€‚';
                        } else {
                            messageElement.textContent = 'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰æ”¶åˆ°æœ‰æ•ˆçš„å›å¤ã€‚è¯·ç¨åå†è¯•ã€‚';
                        }
                    } else {
                        // å°†AIå›å¤æ·»åŠ åˆ°å†å²è®°å½•
                        conversationHistory.push({ role: 'assistant', content: aiReply });
                        
                        // é™åˆ¶å†å²è®°å½•é•¿åº¦ï¼Œé˜²æ­¢è¿‡é•¿
                        if (conversationHistory.length > 20) {
                            // ä¿ç•™æœ€è¿‘çš„å¯¹è¯ï¼Œä½†ç¡®ä¿æˆå¯¹åˆ é™¤ï¼ˆç”¨æˆ·é—®é¢˜å’ŒAIå›ç­”ï¼‰
                            conversationHistory = conversationHistory.slice(2);
                        }
                    }
                    
                    // å¦‚æœæ²¡æœ‰æ€è€ƒå†…å®¹ï¼Œéšè—æ€è€ƒå…ƒç´ 
                    if (!hasThinkTag) {
                        thinkingElement.style.display = 'none';
                    }
                    
                } catch (error) {
                    console.error('è·å–AIå›å¤å‡ºé”™:', error);
                    
                    // éšè—æ€è€ƒå…ƒç´ 
                    if (thinkingElement) {
                        thinkingElement.style.display = 'none';
                    }
                    
                    // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
                    typingIndicator.style.display = 'none';
                    
                    // æ¢å¤å‘é€æŒ‰é’®
                    toggleSendStopButton(false);
                    
                    // ç§»é™¤æ»šåŠ¨äº‹ä»¶ç›‘å¬
                    chatMessages.removeEventListener('scroll', scrollHandler);
                    
                    // æœ¬åœ°å›é€€æ–¹æ¡ˆ - æä¾›é¢„è®¾å›å¤
                    const fallbackResponse = getFallbackResponse(userMessage);
                    
                    // æ˜¾ç¤ºå›é€€å›å¤
                    const fallbackElement = document.createElement('div');
                    fallbackElement.classList.add('message', 'ai-message', 'markdown-body');
                    
                    try {
                        if (typeof marked !== 'undefined') {
                            fallbackElement.innerHTML = marked.parse(fallbackResponse);
                        } else {
                            fallbackElement.textContent = fallbackResponse;
                        }
                    } catch (e) {
                        fallbackElement.textContent = fallbackResponse;
                    }
                    
                    chatMessages.appendChild(fallbackElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // æ·»åŠ åˆ°å¯¹è¯å†å²
                    conversationHistory.push({
                        role: 'assistant',
                        content: fallbackResponse
                    });
                    
                    isGeneratingResponse = false;
                }
            }
            
            // è·å–æœ¬åœ°å›é€€å›å¤
            function getFallbackResponse(userMessage) {
                // ç®€å•çš„å…³é”®è¯åŒ¹é…
                const message = userMessage.toLowerCase();
                
                if (message.includes('ollama') || message.includes('æ¨¡å‹') || message.includes('éƒ¨ç½²')) {
                    return "### Ollamaæœ¬åœ°éƒ¨ç½²æŒ‡å—\n\nå¾ˆæŠ±æ­‰ï¼Œæˆ‘ç›®å‰æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨è·å–è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯Ollamaçš„åŸºæœ¬éƒ¨ç½²æ­¥éª¤ï¼š\n\n1. ä»[å®˜æ–¹ç½‘ç«™](https://ollama.ai)ä¸‹è½½Ollama\n2. å®‰è£…å¹¶è¿è¡ŒOllamaåº”ç”¨\n3. ä½¿ç”¨å‘½ä»¤è¡Œæ‹‰å–æ¨¡å‹ï¼š`ollama pull deepseek-coder`\n4. å¯åŠ¨APIæœåŠ¡ï¼š`ollama serve`\n\nå½“è¿æ¥æ¢å¤åï¼Œæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„æŒ‡å¯¼ã€‚";
                }
                
                if (message.includes('valorant') || message.includes('æ¸¸æˆ') || message.includes('ä¼˜åŒ–')) {
                    return "### Valorantæ¸¸æˆä¼˜åŒ–å»ºè®®\n\nå¾ˆæŠ±æ­‰ï¼Œæˆ‘ç›®å‰æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨è·å–è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬ä¼˜åŒ–å»ºè®®ï¼š\n\n1. æ›´æ–°æ˜¾å¡é©±åŠ¨åˆ°æœ€æ–°ç‰ˆæœ¬\n2. æ¸¸æˆè®¾ç½®ä¸­å…³é—­å‚ç›´åŒæ­¥\n3. é™ä½ç‰¹æ•ˆå’Œé˜´å½±è®¾ç½®\n4. ç¡®ä¿æ²¡æœ‰åå°ç¨‹åºå ç”¨èµ„æº\n\nå½“è¿æ¥æ¢å¤åï¼Œæˆ‘å¯ä»¥æ ¹æ®æ‚¨çš„å…·ä½“é…ç½®æä¾›æ›´è¯¦ç»†çš„å»ºè®®ã€‚";
                }
                
                if (message.includes('ç½‘é¡µ') || message.includes('è®¾è®¡') || message.includes('css')) {
                    return "### ç½‘é¡µè®¾è®¡èµ„æºæ¨è\n\nå¾ˆæŠ±æ­‰ï¼Œæˆ‘ç›®å‰æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨è·å–è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®ç”¨çš„ç½‘é¡µè®¾è®¡èµ„æºï¼š\n\n1. [Figma](https://figma.com) - è®¾è®¡å·¥å…·\n2. [Dribbble](https://dribbble.com) - è®¾è®¡çµæ„Ÿ\n3. [CSS-Tricks](https://css-tricks.com) - CSSæŠ€å·§\n4. [MDN Web Docs](https://developer.mozilla.org) - Webå¼€å‘æ–‡æ¡£\n\nå½“è¿æ¥æ¢å¤åï¼Œæˆ‘å¯ä»¥æä¾›æ›´å¤šé’ˆå¯¹æ€§çš„å»ºè®®ã€‚";
                }
                
                // é»˜è®¤å›å¤
                return "å¾ˆæŠ±æ­‰ï¼Œæˆ‘ç›®å‰æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ï¼Œæˆ–è€…ç¨åå†è¯•ã€‚\n\nå¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ä»¥ä¸‹åŸå› ï¼š\n\n1. APIæœåŠ¡å™¨å¯èƒ½æš‚æ—¶ä¸å¯ç”¨\n2. æ‚¨çš„ç½‘ç»œè¿æ¥å­˜åœ¨é—®é¢˜\n3. æµè§ˆå™¨çš„å®‰å…¨è®¾ç½®é˜»æ­¢äº†è¿æ¥\n\næ‚¨å¯ä»¥å°è¯•åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…æŸ¥çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹é¡µé¢è·å–ä¸€äº›åˆ›æ„çµæ„Ÿã€‚";
            }
            
            // æ„å»ºåŒ…å«å†å²è®°å½•çš„æç¤º
            function buildPromptWithHistory() {
                // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œç›´æ¥è¿”å›ç”¨æˆ·æœ€æ–°æ¶ˆæ¯
                if (conversationHistory.length <= 1) {
                    return conversationHistory[0].content;
                }
                
                // æ„å»ºåŒ…å«å†å²è®°å½•çš„æç¤º
                let prompt = "ä»¥ä¸‹æ˜¯ä¹‹å‰çš„å¯¹è¯å†å²ï¼Œè¯·åŸºäºæ­¤å›ç­”æˆ‘çš„é—®é¢˜ï¼š\n\n";
                
                // æ·»åŠ å†å²è®°å½•
                for (let i = 0; i < conversationHistory.length - 1; i++) {
                    const message = conversationHistory[i];
                    if (message.role === 'user') {
                        prompt += `ç”¨æˆ·: ${message.content}\n`;
                    } else {
                        prompt += `åŠ©æ‰‹: ${message.content}\n`;
                    }
                }
                
                // æ·»åŠ æœ€æ–°çš„ç”¨æˆ·é—®é¢˜
                prompt += `\nç°åœ¨è¯·å›ç­”æˆ‘çš„é—®é¢˜: ${conversationHistory[conversationHistory.length - 1].content}`;
                
                return prompt;
            }
            
            // æ¸…é™¤å¯¹è¯å†å²è®°å½•
            function clearConversationHistory() {
                conversationHistory = [];
                chatMessages.innerHTML = '';
                // æ·»åŠ åˆå§‹AIæ¶ˆæ¯
                addMessage('ä½ å¥½ï¼æˆ‘æ˜¯åˆ›æ„ç©ºé—´çš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®åˆ°ä½ çš„å—ï¼Ÿå¯ä»¥è¯¢é—®æˆ‘å…³äºValorantä¼˜åŒ–ã€åˆ›æ„é¡¹ç›®æˆ–è€…å…¶ä»–ä»»ä½•é—®é¢˜ã€‚', 'ai');
            }
            
            // æ·»åŠ æ¸…é™¤å¯¹è¯æŒ‰é’®
            function addClearButton() {
                // æ¸…é™¤æŒ‰é’®å·²åœ¨HTMLä¸­æ·»åŠ ï¼Œè¿™é‡Œåªéœ€æ·»åŠ äº‹ä»¶ç›‘å¬
                const clearButton = document.querySelector('.clear-button');
                if (clearButton) {
                    clearButton.addEventListener('click', clearConversationHistory);
                }
            }
            
            // æ·»åŠ ä¸‹è½½å¯¹è¯æŒ‰é’®åŠŸèƒ½
            function addDownloadButton() {
                const downloadButton = document.querySelector('.download-button');
                if (downloadButton) {
                    downloadButton.addEventListener('click', downloadConversation);
                }
            }
            
            // ä¸‹è½½å¯¹è¯å†å²è®°å½•
            function downloadConversation() {
                // å¦‚æœæ²¡æœ‰å¯¹è¯ï¼Œä¸æ‰§è¡Œä¸‹è½½
                if (conversationHistory.length <= 1) {
                    alert('å¯¹è¯å†å²ä¸ºç©ºï¼Œæ— æ³•ä¸‹è½½ã€‚');
                    return;
                }
                
                // åˆ›å»ºæ–‡æœ¬å†…å®¹
                let content = 'åˆ›æ„ç©ºé—´AIåŠ©æ‰‹å¯¹è¯è®°å½•\n';
                content += '===================\n\n';
                content += `å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}\n\n`;
                
                // æ·»åŠ å¯¹è¯å†…å®¹
                for (let i = 0; i < conversationHistory.length; i++) {
                    const message = conversationHistory[i];
                    
                    if (message.role === 'user') {
                        content += `ã€ç”¨æˆ·ã€‘: ${message.content}\n\n`;
                        
                        // æ£€æŸ¥ä¸‹ä¸€æ¡æ¶ˆæ¯æ˜¯å¦æ˜¯AIå›å¤ï¼Œå¹¶ä¸”åŒ…å«æ€è€ƒå†…å®¹
                        if (i + 1 < conversationHistory.length && conversationHistory[i + 1].role === 'assistant') {
                            const aiMessage = conversationHistory[i + 1].content;
                            
                            // æå–æ€è€ƒå†…å®¹
                            const thinkMatches = aiMessage.match(/<think>([\s\S]*?)<\/think>/g);
                            if (thinkMatches && thinkMatches.length > 0) {
                                // å¤„ç†æ‰€æœ‰æ€è€ƒå†…å®¹
                                for (const thinkMatch of thinkMatches) {
                                    const thinkContent = thinkMatch.replace(/<think>|<\/think>/g, '').trim();
                                    if (thinkContent) {
                                        content += `ã€AIæ€è€ƒã€‘: ${thinkContent}\n\n`;
                                    }
                                }
                            }
                        }
                    } else if (message.role === 'assistant') {
                        // ç§»é™¤æ‰€æœ‰æ€è€ƒå†…å®¹ï¼Œåªä¿ç•™å›å¤
                        const replyContent = message.content.replace(/<think>[\s\S]*?<\/think>/g, '').trim();
                        content += `ã€AIå›å¤ã€‘: ${replyContent}\n\n`;
                    }
                }
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `AIå¯¹è¯è®°å½•_${new Date().toISOString().slice(0, 10)}.txt`;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(a);
                a.click();
                
                // æ¸…ç†
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // æ·»åŠ å¯¹è¯æ¡†å¯è°ƒæ•´å¤§å°åŠŸèƒ½
            function makeResizable() {
                const chatContainer = document.querySelector('.chat-container');
                const resizeHandle = document.querySelector('.resize-handle');
                const chatModal = document.querySelector('.chat-modal');
                const chatHeader = document.querySelector('.chat-header');
                
                if (!chatContainer || !resizeHandle) return;
                
                let isResizing = false;
                let lastX, lastY;
                let initialWidth, initialHeight;
                
                // å…¨å±åˆ‡æ¢åŠŸèƒ½
                let isFullscreen = false;
                const fullscreenButton = document.querySelector('.fullscreen-button');
                
                if (fullscreenButton) {
                    fullscreenButton.addEventListener('click', () => {
                        isFullscreen = !isFullscreen;
                        
                        if (isFullscreen) {
                            // ä¿å­˜å½“å‰å°ºå¯¸
                            chatContainer.dataset.prevWidth = chatContainer.style.width || '';
                            chatContainer.dataset.prevHeight = chatContainer.style.height || '';
                            
                            // è®¾ç½®ä¸ºå…¨å±
                            chatContainer.classList.add('fullscreen');
                            fullscreenButton.innerHTML = `
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            `;
                        } else {
                            // æ¢å¤ä¹‹å‰çš„å°ºå¯¸
                            chatContainer.classList.remove('fullscreen');
                            if (chatContainer.dataset.prevWidth) {
                                chatContainer.style.width = chatContainer.dataset.prevWidth;
                            }
                            if (chatContainer.dataset.prevHeight) {
                                chatContainer.style.height = chatContainer.dataset.prevHeight;
                            }
                            
                            fullscreenButton.innerHTML = `
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            `;
                        }
                    });
                }
                
                // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
                resizeHandle.addEventListener('mousedown', (e) => {
                    if (isFullscreen) return; // å…¨å±æ¨¡å¼ä¸‹ç¦ç”¨è°ƒæ•´å¤§å°
                    
                    isResizing = true;
                    lastX = e.clientX;
                    lastY = e.clientY;
                    initialWidth = chatContainer.offsetWidth;
                    initialHeight = chatContainer.offsetHeight;
                    
                    // æ·»åŠ ä¸´æ—¶æ ·å¼
                    document.body.style.userSelect = 'none';
                    document.body.style.cursor = 'nwse-resize';
                    
                    // é˜²æ­¢äº‹ä»¶å†’æ³¡
                    e.stopPropagation();
                    e.preventDefault();
                });
                
                // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    
                    const newWidth = initialWidth + (e.clientX - lastX);
                    const newHeight = initialHeight + (e.clientY - lastY);
                    
                    // åªè®¾ç½®æœ€å°å°ºå¯¸é™åˆ¶ï¼Œä¸è®¾ç½®æœ€å¤§å°ºå¯¸é™åˆ¶
                    if (newWidth >= 300) {
                        chatContainer.style.width = `${newWidth}px`;
                    }
                    
                    if (newHeight >= 400) {
                        chatContainer.style.height = `${newHeight}px`;
                    }
                });
                
                // é¼ æ ‡é‡Šæ”¾äº‹ä»¶
                document.addEventListener('mouseup', () => {
                    if (isResizing) {
                        isResizing = false;
                        document.body.style.userSelect = '';
                        document.body.style.cursor = '';
                    }
                });
                
                // æ·»åŠ è§¦æ‘¸æ”¯æŒ
                resizeHandle.addEventListener('touchstart', (e) => {
                    if (isFullscreen) return; // å…¨å±æ¨¡å¼ä¸‹ç¦ç”¨è°ƒæ•´å¤§å°
                    
                    isResizing = true;
                    lastX = e.touches[0].clientX;
                    lastY = e.touches[0].clientY;
                    initialWidth = chatContainer.offsetWidth;
                    initialHeight = chatContainer.offsetHeight;
                    
                    // é˜²æ­¢äº‹ä»¶å†’æ³¡
                    e.stopPropagation();
                }, { passive: false }); // æ˜ç¡®æŒ‡å®šéè¢«åŠ¨ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è°ƒç”¨stopPropagation
                
                document.addEventListener('touchmove', (e) => {
                    if (!isResizing) return;
                    
                    const newWidth = initialWidth + (e.touches[0].clientX - lastX);
                    const newHeight = initialHeight + (e.touches[0].clientY - lastY);
                    
                    // åªè®¾ç½®æœ€å°å°ºå¯¸é™åˆ¶ï¼Œä¸è®¾ç½®æœ€å¤§å°ºå¯¸é™åˆ¶
                    if (newWidth >= 300) {
                        chatContainer.style.width = `${newWidth}px`;
                    }
                    
                    if (newHeight >= 400) {
                        chatContainer.style.height = `${newHeight}px`;
                    }
                }, { passive: true }); // æ ‡è®°ä¸ºè¢«åŠ¨å¼
                
                document.addEventListener('touchend', () => {
                    isResizing = false;
                }, { passive: true }); // æ ‡è®°ä¸ºè¢«åŠ¨å¼
                
                // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´æœ€å¤§å°ºå¯¸
                window.addEventListener('resize', () => {
                    if (isFullscreen) {
                        // ä¿æŒå…¨å±çŠ¶æ€
                        chatContainer.classList.add('fullscreen');
                    }
                });
            }
            
            // å‘é€æ¶ˆæ¯å‡½æ•°
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message === '' || isGeneratingResponse) return;
                
                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                addMessage(message, 'user');
                chatInput.value = '';
                
                // è·å–AIå›å¤
                getAIResponse(message);
            }
            
            // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©çª—å£
            function addMessage(text, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                
                if (sender === 'user') {
                    // ç”¨æˆ·æ¶ˆæ¯ç›´æ¥æ˜¾ç¤ºæ–‡æœ¬
                    messageElement.textContent = text;
                } else {
                    // AIæ¶ˆæ¯ä½¿ç”¨Markdownè§£æ
                    messageElement.classList.add('markdown-body');
                    
                    try {
                        // æ£€æŸ¥Marked.jsæ˜¯å¦å·²åŠ è½½
                        if (typeof marked !== 'undefined') {
                            // å¤„ç†ç‰¹æ®Šçš„Markdownæ‰©å±•
                            text = processCustomMarkdown(text);
                            
                            // ä½¿ç”¨Markedè§£æMarkdown
                            messageElement.innerHTML = marked.parse(text);
                            
                            // å¦‚æœKaTeXå·²åŠ è½½ï¼Œæ¸²æŸ“æ•°å­¦å…¬å¼
                            if (typeof renderMathInElement !== 'undefined') {
                                renderMathInElement(messageElement, {
                                    delimiters: [
                                        {left: '$$', right: '$$', display: true},
                                        {left: '$', right: '$', display: false},
                                        {left: '\\(', right: '\\)', display: false},
                                        {left: '\\[', right: '\\]', display: true}
                                    ],
                                    throwOnError: false
                                });
                            }
                        } else {
                            // å¦‚æœMarked.jsæœªåŠ è½½ï¼Œä½¿ç”¨ç®€å•çš„æ ¼å¼åŒ–
                            console.warn('Marked.jsæœªåŠ è½½ï¼Œä½¿ç”¨çº¯æ–‡æœ¬æ˜¾ç¤º');
                            messageElement.textContent = text;
                        }
                    } catch (error) {
                        console.error('Markdownè§£æé”™è¯¯:', error);
                        messageElement.textContent = text;
                    }
                }
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // å¤„ç†è‡ªå®šä¹‰Markdownæ‰©å±•
            function processCustomMarkdown(text) {
                try {
                    // è‡ªåŠ¨æ·»åŠ æ ‡é¢˜æ ‡è®°
                    const lines = text.split('\n');
                    const processedLines = [];
                    
                    for (let i = 0; i < lines.length; i++) {
                        let line = lines[i];
                        
                        // æ£€æµ‹æ•°å­—å¼€å¤´çš„æ®µè½ï¼Œå¯èƒ½æ˜¯åˆ—è¡¨é¡¹
                        if (/^\d+\.\s/.test(line) && !line.startsWith('# ') && !line.startsWith('## ') && !line.startsWith('- ')) {
                            // å·²ç»æ˜¯åˆ—è¡¨æ ¼å¼ï¼Œä¿æŒä¸å˜
                            processedLines.push(line);
                        } 
                        // æ£€æµ‹å¯èƒ½çš„æ ‡é¢˜ï¼ˆä»¥"å±‚é¢"ã€"å…³ç³»"ç­‰å…³é”®è¯ç»“å°¾çš„çŸ­å¥ï¼‰
                        else if (line.trim() && line.length < 50 && 
                                (line.includes('å±‚é¢') || line.includes('å…³ç³»') || 
                                 line.includes('ä»·å€¼è§‚') || line.includes('æ€»çš„æ¥è¯´'))) {
                            // æ·»åŠ äºŒçº§æ ‡é¢˜æ ‡è®°
                            if (!line.startsWith('#')) {
                                processedLines.push('## ' + line);
                            } else {
                                processedLines.push(line);
                            }
                        } 
                        // å¤„ç†æ™®é€šæ®µè½
                        else {
                            processedLines.push(line);
                        }
                    }
                    
                    // é‡æ–°ç»„åˆæ–‡æœ¬
                    text = processedLines.join('\n');
                    
                    // å¤„ç† \boxed{} è¯­æ³•
                    text = text.replace(/\\boxed\{([^}]+)\}/g, '<span class="boxed">$1</span>');
                    
                    // å¤„ç† \[ \] å’Œ \( \) æ•°å­¦å…¬å¼
                    text = text.replace(/\\\[([\s\S]*?)\\\]/g, '$$$$1$$');
                    text = text.replace(/\\\(([\s\S]*?)\\\)/g, '$$$1$');
                    
                    // è‡ªåŠ¨åŠ ç²—å…³é”®è¯
                    const keywordsToEmbolden = [
                        'ç‰©è´¨å±‚é¢', 'ç²¾ç¥å±‚é¢', 'æ–‡åŒ–ä¸ä»·å€¼è§‚', 'å®‰é€¸', 'å¿«ä¹', 'æ»¡è¶³æ„Ÿ'
                    ];
                    
                    keywordsToEmbolden.forEach(keyword => {
                        const regex = new RegExp(`(?<![*_])(${keyword})(?![*_])`, 'g');
                        text = text.replace(regex, '**$1**');
                    });
                    
                    return text;
                } catch (error) {
                    console.error('å¤„ç†è‡ªå®šä¹‰Markdownå‡ºé”™:', error);
                    return text;
                }
            }
            
            // åˆ‡æ¢å‘é€/åœæ­¢æŒ‰é’®
            function toggleSendStopButton(isGenerating) {
                if (isGenerating) {
                    // åˆ‡æ¢ä¸ºåœæ­¢æŒ‰é’®
                    sendButton.classList.remove('send-button');
                    sendButton.classList.add('stop-button');
                    sendButton.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="6" y="6" width="12" height="12" fill="white"/>
                        </svg>
                    `;
                    sendButton.setAttribute('aria-label', 'åœæ­¢ç”Ÿæˆ');
                    
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
                    sendButton.removeEventListener('click', sendMessage);
                    
                    // æ·»åŠ åœæ­¢ç”Ÿæˆçš„äº‹ä»¶ç›‘å¬å™¨
                    sendButton.addEventListener('click', stopGeneration);
                } else {
                    // æ¢å¤ä¸ºå‘é€æŒ‰é’®
                    sendButton.classList.remove('stop-button');
                    sendButton.classList.add('send-button');
                    sendButton.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    `;
                    sendButton.setAttribute('aria-label', 'å‘é€æ¶ˆæ¯');
                    
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
                    sendButton.removeEventListener('click', stopGeneration);
                    
                    // æ·»åŠ å‘é€æ¶ˆæ¯çš„äº‹ä»¶ç›‘å¬å™¨
                    sendButton.addEventListener('click', sendMessage);
                }
            }
            
            // åœæ­¢ç”Ÿæˆå‡½æ•°
            function stopGeneration() {
                shouldStopGeneration = true;
                console.log('ç”¨æˆ·è¯·æ±‚åœæ­¢ç”Ÿæˆ');
            }
            
            // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€ - ç¡®ä¿åˆå§‹çŠ¶æ€æ˜¯å‘é€æŒ‰é’®
            sendButton.classList.add('send-button');
            sendButton.classList.remove('stop-button');
            
            // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶ - åˆå§‹ç»‘å®š
            sendButton.addEventListener('click', sendMessage);
            
            // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // åˆå§‹æ˜¾ç¤ºèŠå¤©æŒ‰é’®åŠ¨ç”»
            setTimeout(() => {
                chatButton.style.animation = 'pulse 2s infinite';
                
                // 3ç§’ååœæ­¢åŠ¨ç”»
                setTimeout(() => {
                    chatButton.style.animation = '';
                }, 6000);
            }, 2000);
            
            // æ·»åŠ è„‰å†²åŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: scale(1); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
                    50% { transform: scale(1.1); box-shadow: 0 8px 25px rgba(140, 82, 255, 0.6); }
                    100% { transform: scale(1); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
                }
            `;
            document.head.appendChild(style);
            
            // é˜²æ­¢æ§åˆ¶å°æŸ¥çœ‹APIåŸŸå
            // è¦†ç›–consoleæ–¹æ³•
            const originalConsole = window.console;
            window.console = {
                ...originalConsole,
                log: function() {
                    // è¿‡æ»¤åŒ…å«APIåŸŸåçš„æ—¥å¿—
                    const args = [...arguments];
                    const filtered = args.filter(arg => {
                        if (typeof arg === 'string') {
                            return !arg.includes(apiParts[0]) && !arg.includes(apiParts[1]);
                        }
                        return true;
                    });
                    return originalConsole.log(...filtered);
                },
                error: originalConsole.error,
                warn: originalConsole.warn,
                info: originalConsole.info
            };
            
            // ç®€åŒ–çš„APIä¿æŠ¤ - ç§»é™¤å¯èƒ½å¯¼è‡´é—®é¢˜çš„è°ƒè¯•æ£€æµ‹
            function simpleApiProtection() {
                // ç®€å•çš„æ··æ·†ï¼Œä¸ä¼šå¹²æ‰°æ­£å¸¸åŠŸèƒ½
                const checkApiEndpoint = () => {
                    // ä½¿ç”¨éƒ¨ç½²åœ¨Vercelä¸Šçš„ä»£ç†API
                    // æ³¨æ„ï¼šå°†ä¸‹é¢çš„URLæ›¿æ¢ä¸ºæ‚¨çš„Vercelåº”ç”¨URL
                    const vercelProxyUrl = 'https://git-work.vercel.app';
                    
                    // è¿”å›Vercelä»£ç†APIçš„URL
                    return vercelProxyUrl;
                };
                
                // æ›¿æ¢getApiEndpointå‡½æ•°ï¼Œç¡®ä¿å§‹ç»ˆè¿”å›æ­£ç¡®çš„APIåœ°å€
                window.getApiEndpoint = checkApiEndpoint;
            }
            
            // å¯åŠ¨ç®€åŒ–çš„ä¿æŠ¤
            simpleApiProtection();
            
            // åˆå§‹åŒ–èŠå¤©ç•Œé¢
            function initChat() {
                // æ·»åŠ æ¸…é™¤å¯¹è¯æŒ‰é’®
                addClearButton();
                
                // æ·»åŠ ä¸‹è½½å¯¹è¯æŒ‰é’®
                addDownloadButton();
                
                // æ·»åŠ å¯è°ƒæ•´å¤§å°åŠŸèƒ½
                makeResizable();
                
                // åˆå§‹åŒ–å¯¹è¯å†å²
                if (conversationHistory.length === 0) {
                    // æ·»åŠ åˆå§‹AIæ¶ˆæ¯åˆ°å†å²è®°å½•
                    const initialMessage = 'ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„åˆ›æ„ç©ºé—´åŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›ä»¥ä¸‹æœåŠ¡ï¼š\n\nâ€¢ ğŸ® Valorantæ¸¸æˆä¼˜åŒ–æŒ‡å—ä¸å·¥å…·æ”¯æŒ\nâ€¢ ğŸ’» æœ¬åœ°AIæ¨¡å‹éƒ¨ç½²ï¼ˆOllamaæœåŠ¡é…ç½®ï¼‰\nâ€¢ ğŸ¨ åˆ›æ„é¡¹ç›®æ„æ€ä¸å®ç°æ–¹æ¡ˆ\nâ€¢ ğŸ’• ä¸ªæ€§åŒ–ç½‘é¡µè®¾è®¡ä¸äº¤äº’æ•ˆæœ\nâ€¢ ğŸ› ï¸ æŠ€æœ¯é—®é¢˜æ’æŸ¥ä¸è§£å†³æ–¹æ¡ˆ\n\næ‚¨å¯ä»¥ç›´æ¥å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨æä¾›ä¸“ä¸šæ”¯æŒï¼';
                    
                    conversationHistory.push({
                        role: 'assistant',
                        content: initialMessage
                    });
                    
                    // æ˜¾ç¤ºåˆå§‹æ¶ˆæ¯
                    addMessage(initialMessage, 'ai');
                    
                    // æ·»åŠ ä½¿ç”¨æç¤º
                    setTimeout(() => {
                        const tipMessage = 'ğŸ’¡ **ä½¿ç”¨æç¤º**ï¼š\n\n1. æ‚¨å¯ä»¥è¯¢é—®å…³äºOllamaæœ¬åœ°æ¨¡å‹éƒ¨ç½²çš„è¯¦ç»†æ­¥éª¤\n2. éœ€è¦Valorantæ¸¸æˆä¼˜åŒ–æ–¹æ¡ˆæ—¶ï¼Œå¯ä»¥ç›´æ¥æè¿°æ‚¨çš„ç”µè„‘é…ç½®\n3. å¦‚æœæ‚¨æƒ³äº†è§£åˆ›æ„ç½‘é¡µè®¾è®¡ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä»¬çš„ç¤ºä¾‹é¡µé¢\n4. å¯¹äºæŠ€æœ¯é—®é¢˜ï¼Œè¯·å°½é‡æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œç¯å¢ƒæè¿°\n\nè®©æˆ‘ä»¬å¼€å§‹å§ï¼';
                        
                        conversationHistory.push({
                            role: 'assistant',
                            content: tipMessage
                        });
                        
                        addMessage(tipMessage, 'ai');
                    }, 1000);
                }
            }
            
            // åˆå§‹åŒ–èŠå¤©
            initChat();
            
            // å¤„ç†ç”¨æˆ·æ¶ˆæ¯å‘é€
            async function handleSendMessage() {
                const userInput = document.getElementById('chat-input').value.trim();
                if (userInput === '') return;
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('chat-input').value = '';
                
                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²è®°å½•
                conversationHistory.push({
                    role: 'user',
                    content: userInput
                });
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                displayMessages();
                
                // æ˜¾ç¤ºAIæ€è€ƒä¸­çŠ¶æ€
                showThinking();
                
                try {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯Ollamaç›¸å…³æŸ¥è¯¢
                    if (isOllamaQuery(userInput)) {
                        // å¤„ç†Ollamaç›¸å…³æŸ¥è¯¢
                        await handleOllamaQuery(userInput);
                    } 
                    // æ£€æŸ¥æ˜¯å¦æ˜¯è®¾è®¡ç›¸å…³æŸ¥è¯¢
                    else if (isDesignQuery(userInput)) {
                        // å¤„ç†è®¾è®¡ç›¸å…³æŸ¥è¯¢
                        await handleDesignQuery(userInput);
                    }
                    else {
                        // è°ƒç”¨APIè·å–å›å¤
                        const response = await callChatAPI(userInput);
                        
                        // æ·»åŠ AIå›å¤åˆ°å†å²è®°å½•
                        conversationHistory.push({
                            role: 'assistant',
                            content: response
                        });
                    }
                } catch (error) {
                    console.error('Error:', error);
                    // æ·»åŠ é”™è¯¯æ¶ˆæ¯åˆ°å†å²è®°å½•
                    conversationHistory.push({
                        role: 'assistant',
                        content: 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†ä¸€äº›é”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚'
                    });
                } finally {
                    // éšè—AIæ€è€ƒä¸­çŠ¶æ€
                    hideThinking();
                    
                    // æ˜¾ç¤ºæ›´æ–°åçš„æ¶ˆæ¯
                    displayMessages();
                    
                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    scrollToBottom();
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯Ollamaç›¸å…³æŸ¥è¯¢
            function isOllamaQuery(query) {
                const ollamaKeywords = [
                    'ollama', 'æœ¬åœ°æ¨¡å‹', 'å¤§æ¨¡å‹éƒ¨ç½²', 'llama', 'qwen', 'deepseek',
                    'æ¨¡å‹ä¸‹è½½', 'æ¨¡å‹å®‰è£…', 'chatbox', 'æœ¬åœ°éƒ¨ç½²', 'apiè°ƒç”¨'
                ];
                
                return ollamaKeywords.some(keyword => 
                    query.toLowerCase().includes(keyword.toLowerCase())
                );
            }
            
            // å¤„ç†Ollamaç›¸å…³æŸ¥è¯¢
            async function handleOllamaQuery(query) {
                // å¼€å§‹æ€è€ƒè¿‡ç¨‹
                updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...');
                await sleep(500);
                
                updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...');
                await sleep(800);
                
                // æ ¹æ®æŸ¥è¯¢å†…å®¹æä¾›ä¸“ä¸šå›ç­”
                let response = '';
                
                if (query.includes('å®‰è£…') || query.includes('ä¸‹è½½')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡Ollamaå®‰è£…æŒ‡å—...');
                    await sleep(700);
                    
                    response = `### Ollamaå®‰è£…æŒ‡å—\n\n1. **ä¸‹è½½Ollama**\n   - è®¿é—®å®˜æ–¹ç½‘ç«™: [www.ollama.com/download](https://www.ollama.com/download)\n   - é€‰æ‹©é€‚åˆæ‚¨æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬(Windows/MacOS/Linux)\n   - ä¸‹è½½å®‰è£…åŒ…(çº¦277MB)\n\n2. **å®‰è£…æ­¥éª¤**\n   - åŒå‡»å®‰è£…åŒ…è¿è¡Œå®‰è£…å‘å¯¼\n   - æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…\n   - å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä½¿ç”¨\n\n3. **éªŒè¯å®‰è£…**\n   - æ‰“å¼€å‘½ä»¤æç¤ºç¬¦(CMD)\n   - è¾“å…¥å‘½ä»¤: \`ollama run llama3\` æµ‹è¯•å®‰è£…\n\néœ€è¦æ›´è¯¦ç»†çš„å®‰è£…æŒ‡å—æˆ–é‡åˆ°é—®é¢˜éœ€è¦æ’æŸ¥å—ï¼Ÿ`;
                    
                } else if (query.includes('æ¨¡å‹') || query.includes('qwen') || query.includes('llama')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...\n\næ•´ç†å¯ç”¨æ¨¡å‹åˆ—è¡¨å’Œä¸‹è½½æ–¹æ³•...');
                    await sleep(700);
                    
                    response = `### Ollamaæ¨¡å‹ä¸‹è½½ä¸ä½¿ç”¨\n\n1. **æ¨èæ¨¡å‹**\n   - ä¸­æ–‡ä»»åŠ¡æ¨è: Qwenç³»åˆ—(qwen:7b, qwen:14b, qwen2:7b)\n   - è‹±æ–‡ä»»åŠ¡æ¨è: Llama3ç³»åˆ—(llama3:8b, llama3:70b)\n   - é€šç”¨æ¨¡å‹: DeepSeekç³»åˆ—(deepseek-r1:8b)\n\n2. **ä¸‹è½½å‘½ä»¤**\n   - Qwenæ¨¡å‹: \`ollama run qwen:7b\`\n   - Llama3æ¨¡å‹: \`ollama run llama3\`\n   - DeepSeekæ¨¡å‹: \`ollama run deepseek-r1:8b\`\n\n3. **æ¨¡å‹é€‰æ‹©å»ºè®®**\n   - 7Bæ¨¡å‹: é€‚åˆ8GBå†…å­˜ç”µè„‘\n   - 14Bæ¨¡å‹: å»ºè®®16GBå†…å­˜ä»¥ä¸Š\n   - 70Bæ¨¡å‹: éœ€è¦é«˜ç«¯æ˜¾å¡(æ˜¾å­˜â‰¥24GB)\n\néœ€è¦äº†è§£æ›´å¤šæ¨¡å‹å‚æ•°æˆ–ç‰¹å®šæ¨¡å‹çš„è¯¦ç»†ä¿¡æ¯å—ï¼Ÿ`;
                    
                } else if (query.includes('chatbox') || query.includes('ç•Œé¢')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡Chatboxé…ç½®æŒ‡å—...');
                    await sleep(700);
                    
                    response = `### Chatboxé…ç½®ä¸Ollamaè¿æ¥\n\n1. **å®‰è£…Chatbox**\n   - è®¿é—®å®˜æ–¹ç½‘ç«™: [chatboxai.app/zh](https://chatboxai.app/zh/)\n   - ä¸‹è½½å¹¶å®‰è£…Chatboxå®¢æˆ·ç«¯\n\n2. **è¿æ¥Ollama**\n   - æ‰“å¼€Chatboxï¼Œç‚¹å‡»å·¦ä¸‹è§’"è®¾ç½®"\n   - åœ¨æ¨¡å‹æä¾›æ–¹ä¸­é€‰æ‹©"Ollama"\n   - ç¡®ä¿APIåœ°å€ä¸º: \`http://127.0.0.1:11434\`\n   - ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©å·²å®‰è£…çš„æ¨¡å‹\n   - ç‚¹å‡»ä¿å­˜\n\n3. **è¿œç¨‹è¿æ¥é…ç½®**\n   - å¦‚éœ€ä»å…¶ä»–è®¾å¤‡è¿æ¥ï¼Œéœ€è®¾ç½®ç¯å¢ƒå˜é‡:\n     - \`OLLAMA_HOST=0.0.0.0\`\n     - \`OLLAMA_ORIGINS=*\`\n   - ä½¿ç”¨æœåŠ¡å™¨IPåœ°å€è¿æ¥: \`http://192.168.XX.XX:11434\`\n\néœ€è¦æ›´è¯¦ç»†çš„Chatboxé…ç½®æŒ‡å—æˆ–é‡åˆ°è¿æ¥é—®é¢˜éœ€è¦æ’æŸ¥å—ï¼Ÿ`;
                    
                } else if (query.includes('api') || query.includes('è°ƒç”¨')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡APIè°ƒç”¨ç¤ºä¾‹...');
                    await sleep(700);
                    
                    response = `### Ollama APIè°ƒç”¨æŒ‡å—\n\n1. **APIåŸºæœ¬ä¿¡æ¯**\n   - é»˜è®¤åœ°å€: \`http://127.0.0.1:11434/api\`\n   - å…¼å®¹OpenAIæ ¼å¼: \`http://127.0.0.1:11434/v1\`\n\n2. **Pythonè°ƒç”¨ç¤ºä¾‹**\n\`\`\`python\nimport requests\n\nurl = "http://127.0.0.1:11434/api/generate"\ndata = {\n    "model": "qwen:7b",\n    "prompt": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±",\n    "stream": False\n}\n\nresponse = requests.post(url, json=data)\nprint(response.json()["response"])\n\`\`\`\n\n3. **JavaScriptè°ƒç”¨ç¤ºä¾‹**\n\`\`\`javascript\nasync function callOllama() {\n    const response = await fetch("http://127.0.0.1:11434/api/generate", {\n        method: "POST",\n        headers: { "Content-Type": "application/json" },\n        body: JSON.stringify({\n            model: "qwen:7b",\n            prompt: "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"\n        })\n    });\n    const data = await response.json();\n    console.log(data.response);\n}\n\`\`\`\n\néœ€è¦å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„è°ƒç”¨ç¤ºä¾‹æˆ–æ›´å¤æ‚çš„APIå‚æ•°è®¾ç½®å—ï¼Ÿ`;
                    
                } else {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„Ollamaç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ£€ç´¢Ollamaéƒ¨ç½²å’Œé…ç½®çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡ç»¼åˆè§£ç­”...');
                    await sleep(700);
                    
                    response = `### Ollamaæœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²æŒ‡å—\n\n1. **Ollamaç®€ä»‹**\n   Ollamaæ˜¯ä¸€æ¬¾å¼€æºå·¥å…·ï¼Œå¯åœ¨æœ¬åœ°ç”µè„‘ä¸Šè¿è¡Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼Œæ— éœ€äº‘æœåŠ¡ï¼Œä¿æŠ¤éšç§æ•°æ®å®‰å…¨ã€‚\n\n2. **éƒ¨ç½²æµç¨‹**\n   - ä¸‹è½½å®‰è£…Ollama: [ollama.com/download](https://ollama.com/download)\n   - é€šè¿‡å‘½ä»¤è¡Œä¸‹è½½æ¨¡å‹: \`ollama run æ¨¡å‹åç§°\`\n   - å¯é€‰å®‰è£…Chatboxæä¾›å›¾å½¢ç•Œé¢\n\n3. **å¸¸è§é—®é¢˜**\n   - æ¨¡å‹é€‰æ‹©: æ ¹æ®ç”µè„‘é…ç½®é€‰æ‹©åˆé€‚å¤§å°çš„æ¨¡å‹\n   - å†…å­˜ä¸è¶³: å°è¯•ä½¿ç”¨è¾ƒå°å‚æ•°çš„æ¨¡å‹(å¦‚7B)\n   - è¿è¡Œç¼“æ…¢: æ£€æŸ¥æ˜¯å¦æœ‰GPUåŠ é€Ÿ\n\n4. **è¿›é˜¶åº”ç”¨**\n   - APIè°ƒç”¨: é€šè¿‡HTTPè¯·æ±‚ä¸æ¨¡å‹äº¤äº’\n   - è¿œç¨‹è®¿é—®: é…ç½®ç¯å¢ƒå˜é‡å…è®¸ç½‘ç»œå†…å…¶ä»–è®¾å¤‡è®¿é—®\n   - æ¨¡å‹å¾®è°ƒ: ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ä¼˜åŒ–æ¨¡å‹\n\næ‚¨æƒ³äº†è§£å“ªæ–¹é¢çš„è¯¦ç»†ä¿¡æ¯ï¼Ÿå¯ä»¥è¯¢é—®å®‰è£…æ­¥éª¤ã€æ¨¡å‹é€‰æ‹©ã€ç•Œé¢é…ç½®æˆ–APIè°ƒç”¨ç­‰å…·ä½“é—®é¢˜ã€‚`;
                }
                
                // æ·»åŠ AIå›å¤åˆ°å†å²è®°å½•
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });
                
                return response;
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šå»¶è¿Ÿæ‰§è¡Œ
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ›æ„ç½‘é¡µè®¾è®¡ç›¸å…³æŸ¥è¯¢
            function isDesignQuery(query) {
                const designKeywords = [
                    'ç½‘é¡µè®¾è®¡', 'åˆ›æ„', 'ui', 'ux', 'ç•Œé¢', 'äº¤äº’', 'åŠ¨ç”»',
                    'ç‰¹æ•ˆ', 'css', 'html', 'å‰ç«¯', 'è®¾è®¡', 'å¸ƒå±€', 'å“åº”å¼'
                ];
                
                return designKeywords.some(keyword => 
                    query.toLowerCase().includes(keyword.toLowerCase())
                );
            }
            
            // å¤„ç†åˆ›æ„ç½‘é¡µè®¾è®¡ç›¸å…³æŸ¥è¯¢
            async function handleDesignQuery(query) {
                // å¼€å§‹æ€è€ƒè¿‡ç¨‹
                updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...');
                await sleep(500);
                
                updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ•´ç†åˆ›æ„ç½‘é¡µè®¾è®¡çš„æœ€ä½³å®è·µ...');
                await sleep(800);
                
                // æ ¹æ®æŸ¥è¯¢å†…å®¹æä¾›ä¸“ä¸šå›ç­”
                let response = '';
                
                if (query.includes('åŠ¨ç”»') || query.includes('ç‰¹æ•ˆ')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ•´ç†åˆ›æ„ç½‘é¡µè®¾è®¡çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡ç½‘é¡µåŠ¨ç”»æ•ˆæœç¤ºä¾‹...');
                    await sleep(700);
                    
                    response = `### ç½‘é¡µåŠ¨ç”»ä¸ç‰¹æ•ˆè®¾è®¡æŒ‡å—\n\n1. **æ¨èåŠ¨ç”»åº“**\n   - [GSAP](https://greensock.com/gsap/) - ä¸“ä¸šçº§åŠ¨ç”»åº“\n   - [Anime.js](https://animejs.com/) - è½»é‡çº§åŠ¨ç”»å¼•æ“\n   - [Lottie](https://airbnb.design/lottie/) - æ”¯æŒAfter EffectsåŠ¨ç”»\n   - [Three.js](https://threejs.org/) - 3DåŠ¨ç”»æ•ˆæœ\n\n2. **å¸¸ç”¨åŠ¨ç”»æ•ˆæœ**\n   - æ·¡å…¥æ·¡å‡º: CSSçš„opacityè¿‡æ¸¡\n   - æ»‘åŠ¨æ•ˆæœ: transformä¸transitionç»“åˆ\n   - è§†å·®æ»šåŠ¨: å¤šå±‚æ¬¡æ»šåŠ¨é€Ÿåº¦å·®å¼‚\n   - å¾®äº¤äº’: å°å‹åŠ¨ç”»åé¦ˆç”¨æˆ·æ“ä½œ\n\n3. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**\n   - ä½¿ç”¨CSS transformå’Œopacityå±æ€§\n   - é¿å…é¢‘ç¹æ”¹å˜å¸ƒå±€å±æ€§\n   - ä½¿ç”¨requestAnimationFrame\n   - è€ƒè™‘ç§»åŠ¨è®¾å¤‡æ€§èƒ½é™åˆ¶\n\n4. **ç¤ºä¾‹ä»£ç **\n\`\`\`css\n/* ç®€å•æ·¡å…¥æ•ˆæœ */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n.element {\n  animation: fadeIn 0.5s ease forwards;\n}\n\`\`\`\n\næ‚¨å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„[çˆ±å¿ƒåŠ¨ç”»é¡µé¢](love.html)ä½œä¸ºå‚è€ƒï¼Œå…¶ä¸­åŒ…å«äº†å¤šç§äº¤äº’åŠ¨ç”»æ•ˆæœã€‚éœ€è¦æ›´å¤šå…·ä½“åŠ¨ç”»æ•ˆæœçš„å®ç°æ–¹æ³•å—ï¼Ÿ`;
                    
                } else if (query.includes('å“åº”å¼') || query.includes('é€‚é…')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ•´ç†åˆ›æ„ç½‘é¡µè®¾è®¡çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡å“åº”å¼è®¾è®¡æ–¹æ¡ˆ...');
                    await sleep(700);
                    
                    response = `### å“åº”å¼ç½‘é¡µè®¾è®¡æŒ‡å—\n\n1. **å“åº”å¼è®¾è®¡æ ¸å¿ƒåŸåˆ™**\n   - æµå¼å¸ƒå±€: ä½¿ç”¨ç™¾åˆ†æ¯”è€Œéå›ºå®šåƒç´ \n   - å¼¹æ€§å›¾ç‰‡: max-width: 100%ç¡®ä¿é€‚åº”å®¹å™¨\n   - åª’ä½“æŸ¥è¯¢: é’ˆå¯¹ä¸åŒè®¾å¤‡å®½åº¦è°ƒæ•´æ ·å¼\n   - ç§»åŠ¨ä¼˜å…ˆ: ä»å°å±å¹•è®¾è®¡å¼€å§‹å‘ä¸Šæ‰©å±•\n\n2. **å¸¸ç”¨å“åº”å¼æ¡†æ¶**\n   - [Bootstrap](https://getbootstrap.com/) - æœ€æµè¡Œçš„å“åº”å¼æ¡†æ¶\n   - [Tailwind CSS](https://tailwindcss.com/) - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶\n   - [Foundation](https://get.foundation/) - ä¼ä¸šçº§å“åº”å¼æ¡†æ¶\n\n3. **å…³é”®åª’ä½“æŸ¥è¯¢æ–­ç‚¹**\n\`\`\`css\n/* ç§»åŠ¨è®¾å¤‡ */\n@media (max-width: 767px) { ... }\n\n/* å¹³æ¿è®¾å¤‡ */\n@media (min-width: 768px) and (max-width: 1023px) { ... }\n\n/* æ¡Œé¢è®¾å¤‡ */\n@media (min-width: 1024px) { ... }\n\`\`\`\n\n4. **å“åº”å¼è®¾è®¡æµ‹è¯•å·¥å…·**\n   - Chrome DevToolsçš„è®¾å¤‡æ¨¡æ‹Ÿ\n   - [Responsively App](https://responsively.app/) - å¤šè®¾å¤‡é¢„è§ˆ\n   - [BrowserStack](https://www.browserstack.com/) - çœŸå®è®¾å¤‡æµ‹è¯•\n\næ‚¨å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„[ä¸‹è½½é¡µé¢](download.html)ä½œä¸ºå“åº”å¼è®¾è®¡çš„å‚è€ƒã€‚éœ€è¦é’ˆå¯¹ç‰¹å®šè®¾å¤‡çš„é€‚é…å»ºè®®å—ï¼Ÿ`;
                    
                } else if (query.includes('å¸ƒå±€') || query.includes('grid') || query.includes('flex')) {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ•´ç†åˆ›æ„ç½‘é¡µè®¾è®¡çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡ç°ä»£å¸ƒå±€æŠ€æœ¯æŒ‡å—...');
                    await sleep(700);
                    
                    response = `### ç°ä»£ç½‘é¡µå¸ƒå±€æŠ€æœ¯æŒ‡å—\n\n1. **Flexboxå¸ƒå±€**\n   - é€‚ç”¨äºä¸€ç»´å¸ƒå±€(è¡Œæˆ–åˆ—)\n   - ä¸»è¦å±æ€§: display: flex, flex-direction, justify-content, align-items\n   - ç‰¹ç‚¹: çµæ´»åˆ†é…ç©ºé—´ï¼Œç®€åŒ–å¯¹é½\n\n\`\`\`css\n.container {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\`\`\`\n\n2. **Gridå¸ƒå±€**\n   - é€‚ç”¨äºäºŒç»´å¸ƒå±€(è¡Œå’Œåˆ—)\n   - ä¸»è¦å±æ€§: display: grid, grid-template-columns, grid-gap\n   - ç‰¹ç‚¹: ç²¾ç¡®æ§åˆ¶äºŒç»´ç©ºé—´ï¼ŒåŒºåŸŸåˆ’åˆ†\n\n\`\`\`css\n.container {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  grid-gap: 20px;\n}\n\`\`\`\n\n3. **å¸ƒå±€ç­–ç•¥**\n   - å†…å®¹ä¼˜å…ˆ: è®©å†…å®¹å†³å®šå¸ƒå±€\n   - ç»„ä»¶åŒ–æ€ç»´: è®¾è®¡å¯å¤ç”¨çš„å¸ƒå±€ç»„ä»¶\n   - åµŒå¥—å¸ƒå±€: Flexå’ŒGridç»“åˆä½¿ç”¨\n   - å‘½åç½‘æ ¼åŒºåŸŸ: æé«˜å¸ƒå±€å¯è¯»æ€§\n\n4. **å¸¸è§å¸ƒå±€æ¨¡å¼**\n   - åœ£æ¯å¸ƒå±€/åŒé£ç¿¼å¸ƒå±€\n   - å¡ç‰‡ç½‘æ ¼å¸ƒå±€\n   - å…¨å±åˆ†æ å¸ƒå±€\n   - äº¤é”™å¸ƒå±€\n\néœ€è¦æŸç§ç‰¹å®šå¸ƒå±€çš„å®ç°ä»£ç ç¤ºä¾‹å—ï¼Ÿ`;
                    
                } else {
                    updateThinkingContent('æ­£åœ¨åˆ†ææ‚¨çš„ç½‘é¡µè®¾è®¡ç›¸å…³é—®é¢˜...\n\næ­£åœ¨æ•´ç†åˆ›æ„ç½‘é¡µè®¾è®¡çš„æœ€ä½³å®è·µ...\n\nå‡†å¤‡ç»¼åˆè®¾è®¡æŒ‡å—...');
                    await sleep(700);
                    
                    response = `### åˆ›æ„ç½‘é¡µè®¾è®¡ç»¼åˆæŒ‡å—\n\n1. **è®¾è®¡è¶‹åŠ¿**\n   - æ–°æ‹Ÿæ€è®¾è®¡(Neumorphism)\n   - æš—é»‘æ¨¡å¼(Dark Mode)\n   - å¾®äº¤äº’ä¸åŠ¨æ•ˆ\n   - 3Då…ƒç´ ä¸æ²‰æµ¸å¼ä½“éªŒ\n   - æ¸å˜ä¸é²œè‰³è‰²å½©\n\n2. **è®¾è®¡åŸåˆ™**\n   - è§†è§‰å±‚æ¬¡: å¼•å¯¼ç”¨æˆ·æ³¨æ„åŠ›\n   - ä¸€è‡´æ€§: ä¿æŒè®¾è®¡è¯­è¨€ç»Ÿä¸€\n   - ç®€æ´æ€§: å‡å°‘ä¸å¿…è¦å…ƒç´ \n   - å¯è®¿é—®æ€§: è€ƒè™‘æ‰€æœ‰ç”¨æˆ·éœ€æ±‚\n   - å“åº”å¼: é€‚åº”å„ç§è®¾å¤‡\n\n3. **å®ç”¨èµ„æº**\n   - è®¾è®¡çµæ„Ÿ: [Awwwards](https://www.awwwards.com/), [Dribbble](https://dribbble.com/)\n   - è‰²å½©å·¥å…·: [Coolors](https://coolors.co/), [Adobe Color](https://color.adobe.com/)\n   - å­—ä½“èµ„æº: [Google Fonts](https://fonts.google.com/), [Font Pair](https://fontpair.co/)\n   - å›¾æ ‡åº“: [Font Awesome](https://fontawesome.com/), [Feather Icons](https://feathericons.com/)\n\n4. **æˆ‘ä»¬çš„ç¤ºä¾‹é¡µé¢**\n   - [çˆ±å¿ƒåŠ¨ç”»](love.html) - äº¤äº’åŠ¨ç”»æ•ˆæœ\n   - [ä¸‹è½½é¡µé¢](download.html) - å“åº”å¼è®¾è®¡\n   - [Ninestarsæ¨¡æ¿](ninestars.html) - ç°ä»£ä¼ä¸šç½‘ç«™\n\næ‚¨å¯¹å“ªæ–¹é¢çš„ç½‘é¡µè®¾è®¡æ›´æ„Ÿå…´è¶£ï¼Ÿæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„å»ºè®®å’Œä»£ç ç¤ºä¾‹ã€‚`;
                }
                
                // æ·»åŠ AIå›å¤åˆ°å†å²è®°å½•
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });
                
                return response;
            }
            
            // æ˜¾ç¤ºå¯¹è¯å†å²è®°å½•
            function displayMessages() {
                // æ¸…ç©ºèŠå¤©æ¶ˆæ¯åŒºåŸŸ
                chatMessages.innerHTML = '';
                
                // éå†å¯¹è¯å†å²è®°å½•
                for (const message of conversationHistory) {
                    // æ ¹æ®è§’è‰²æ·»åŠ æ¶ˆæ¯
                    if (message.role === 'user') {
                        addMessage(message.content, 'user');
                    } else if (message.role === 'assistant') {
                        addMessage(message.content, 'ai');
                    }
                }
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });
    </script>
</body>
</html> 